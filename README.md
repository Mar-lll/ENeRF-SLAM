## Installation

```
sudo apt-get install libopenexr-dev
    
conda env create -f environment.yaml
conda activate enerf-slam
```

## Run

## Synthetic Dataset

The data can be generated by [simulator]([zsustc/colon_reconstruction_dataset: this repository contains a brief introduction of simulated data for colon 3D reconstruction and the dataset download link](https://github.com/zsustc/colon_reconstruction_dataset?tab=readme-ov-file)). Then organize the data as follows.

```
Datasets/synthetic01
|---results
|      |----depth000000.png
|      |----depth000001.png
|      ...
|      ...
|      |----frame000000.png
|      |----frame000001.png
|      ...
|      ...
|---traj.txt
```

**Note**: The format of traj.txt is consistent with that of the replica dataset.

Next, run ENerf-SLAM

```
python -W ignore run.py configs/Syn/syn1.yaml
```

### Hamlyn Dataset

The data can be found [here](https://unizares-my.sharepoint.com/:f:/g/personal/recasens_unizar_es/Epwqt3JCs4BJnEiV9esUH0gBeJYbTmmNCouEpncW4MjC8A?e=B0cYB2). Then organize the data as follows.

```
Datasets/hamlyn
|---results
|      |----depth000000.png
|      |----depth000001.png
|      ...
|      ...
|      |----frame000000.png
|      |----frame000001.png
|      ...
|      ...
```

**Note**: There is no groundtruth trajectory for Hamlyn Dataset.

Next, run ENerf-SLAM

```
python -W ignore run.py configs/Hamlyn/rectified01.yaml
```

### C3VD Dataset

The data can be found [here]([C3VD](https://durrlab.github.io/C3VD/)). Then organize the data as follows.

```
Datasets/desc_t4_a(trans_t2_b)
|---color_undistorted
|      |----0000_color.png
|      |----0001_color.png
|      ...
|      ...
|---depth_undistorted
|      |----0000_depth.tiff
|      |----0001_depth.tiff
|      ...
|      ...
|---pose.txt
```

Next, run ENerf-SLAM

```
python -W ignore run.py configs/C3VD/trans2b.yaml
```

## Evaluation

### Average Trajectory Error

To evaluate the average trajectory error. Run the command below with the corresponding config file:

```bash
python src/tools/eval_ate.py configs/Replica/room0.yaml
```

## Related Repositories

Our codebase is based on [NICE-SLAM](https://github.com/cvg/nice-slam) and [Endo-Depth-and-Motion](https://github.com/UZ-SLAMLab/Endo-Depth-and-Motion). We are grateful to the authors for sharing their codebase with the public. Your significant contributions have been instrumental in making our work a reality!

## Citation

If you find our code or paper useful, please cite

```
@article{shan2024enerf,
  title={ENeRF-SLAM: A Dense Endoscopic SLAM With Neural Implicit Representation},
  author={Shan, Jiwei and Li, Yirui and Xie, Ting and Wang, Hesheng},
  journal={IEEE Transactions on Medical Robotics and Bionics},
  year={2024},
  publisher={IEEE}
}
```